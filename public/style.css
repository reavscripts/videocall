:root{
    --primary-color:#00bcd4;
    --accent-color:#ff9800;
    --bg:#0f0f10;
    --surface:#1e1e1e;
    --muted:#b0b0b0;
    --danger:#ef5350;
    --panel-width-desktop: 300px;
}
*{box-sizing:border-box}
html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:#fff;
    font-family:Roboto,Arial,sans-serif;
}
.hidden{display:none!important}

/* Overlay Iniziale */
#nickname-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
    z-index:200;
}

#app-logo{
    width:180px;
    height:auto;
    margin-bottom:10px;
    animation:fadeIn 0.4s ease;
}

.card{
    background:var(--surface);
    padding:28px;
    border-radius:10px;
    width:360px;
    text-align:center;
    animation:slideDown 0.4s ease;
}

.card h2{
    color:var(--primary-color);
    margin-bottom:20px;
}

.card input[type="text"]{
    width:calc(100% - 20px);
    padding:12px;
    margin-bottom:15px;
    border:1px solid #444;
    border-radius:6px;
    background:rgba(255,255,255,0.1);
    color:#fff;
    font-size:1em;
    outline:none;
}

.card input[type="text"]::placeholder{
    color:var(--muted);
}

.card button{
    background:var(--primary-color);
    color:var(--bg);
    padding:12px 25px;
    border:none;
    border-radius:6px;
    font-size:1.1em;
    font-weight:bold;
    cursor:pointer;
    transition:background-color 0.2s ease;
}

.card button:hover{
    background:var(--accent-color);
}

/* Conferenza */
#conference-container{
    display:flex;
    flex-direction:column;
    width:100vw;
    height:100vh;
    overflow:hidden;
}

#room-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 20px;
    background:var(--surface);
    border-bottom:1px solid #333;
    z-index:100;
}

#room-header h3{
    margin:0;
    color:var(--text-color);
    font-size:1.1em;
}

#room-name-display{
    color:var(--primary-color);
}

.header-controls{
    display:flex;
    gap:8px;
}

.header-controls button,.header-controls input[type="button"]{
    background:var(--surface);
    color:#fff;
    border:none;
    border-radius:5px;
    padding:8px;
    font-size:0.9em;
    cursor:pointer;
    transition:background-color 0.2s ease;
    display:flex;
    align-items:center;
    gap:4px;
}

.header-controls button:hover,.header-controls input[type="button"]:hover{
    background:#444;
}

/* Main Area */
#main-area{
    flex-grow:1;
    display:flex;
    position:relative;
    overflow:hidden;
}

/* Video Grid */
#videos-grid{
    flex-grow:1;
    display:flex;
    flex-wrap:wrap;
    justify-content:flex-start; 
    align-items:flex-start;
    gap:10px;
    padding:10px;
    background:var(--bg);
    overflow-y:auto;
    transition:margin-right 0.3s ease;
}

.video-feed{
    background:var(--surface);
    border-radius:8px;
    overflow:hidden;
    position:relative;
    box-shadow:0 2px 8px rgba(0,0,0,0.4);
    transition:width 0.3s ease, height 0.3s ease, border-color 0.2s ease, transform 0.2s ease;
    border:3px solid transparent;
}

/* Dimensioni predefinite per video NON in focus (restano 4:3) */
.video-feed.ratio-4-3 {
    width: 240px; 
    height: 180px; 
}

.video-feed.ratio-16-9 {
    width: 240px;
    height: 135px; /* 16:9 più piccolo per gli altri video */
}

/* Video in focus (generico) */
.video-feed.is-focused{
    border-color:var(--primary-color);
    order: -1; 
}

/* 1. Video in focus 4:3 (Webcam) - Dimensione standard in focus */
.video-feed.is-focused.ratio-4-3 {
    width: 640px; 
    height: 480px; 
}

/* 2. Video in focus 16:9 (Screen Share) - FIX: Più largo per 16:9 */
.video-feed.is-focused.ratio-16-9 {
    width: 800px; 
    height: 450px; 
}

.video-feed video{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
}

/* Placeholder per quando non ci sono video remoti */
#remote-video-placeholder {
    width: 300px;
    height: 225px;
    background-color: #2a2a2a;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--muted);
    font-size: 1.1em;
    text-align: center;
}

.video-label{
    position:absolute;
    bottom:5px;
    left:5px;
    background:rgba(0,0,0,0.6);
    color:#fff;
    padding:3px 8px;
    border-radius:4px;
    font-size:0.8em;
    display:flex;
    align-items:center;
    gap:5px;
}

.local-mute-toggle,.remote-mute-toggle{
    position:absolute;
    top:5px;
    right:5px;
    background:rgba(0,0,0,0.6);
    color:#fff;
    border:none;
    border-radius:50%;
    width:30px;
    height:30px;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    font-size:1.2em;
}

/* Chat Panel (Desktop Sidebar) */
#chat-panel{
    width:var(--panel-width-desktop);
    min-width:var(--panel-width-desktop);
    background:var(--surface);
    display:flex;
    flex-direction:column;
    border-left:1px solid #333;
    z-index:150;
}

#chat-panel.hidden{
    display:none !important;
}

#chat-panel h3{
    margin:0;
    padding:15px 20px;
    color:var(--primary-color);
    border-bottom:1px solid #333;
    font-size:1.2em;
}

#messages-container{
    flex-grow:1;
    padding:15px 20px;
    overflow-y:auto;
    display:flex;
    flex-direction:column;
    gap:10px;
}

.chat-message{
    font-size:0.95em;
    line-height:1.4;
}

.sender-me{
    color:var(--primary-color);
    font-weight:bold;
}

.sender-remote{
    color:var(--accent-color);
    font-weight:bold;
}

#chat-input-area{
    display:flex;
    padding:10px;
    border-top:1px solid #333;
    gap:8px;
}

#chat-message-input{
    flex-grow:1;
    padding:10px;
    border:1px solid #444;
    border-radius:6px;
    background:#2a2a2a;
    color:#fff;
    font-size:1em;
    outline:none;
}

#send-chat-button{
    background:var(--primary-color);
    color:var(--bg);
    border:none;
    border-radius:6px;
    padding:10px 15px;
    font-size:1em;
    font-weight:bold;
    cursor:pointer;
}

#send-chat-button:hover{
    background:var(--accent-color);
}

/* Main Controls Bar */
#main-controls-bar{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:15px;
    background:rgba(0,0,0,0.8);
    padding:12px 20px;
    border-radius:12px;
    z-index:200;
}

#main-controls-bar button{
    background:var(--surface);
    color:#fff;
    border:none;
    border-radius:50%;
    width:48px;
    height:48px;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    transition:background-color 0.2s ease;
    box-shadow:0 2px 4px rgba(0,0,0,0.3);
}

#main-controls-bar button:hover{
    background:var(--primary-color);
    color:var(--bg);
}

#main-controls-bar button .material-icons{
    font-size:1.8em;
}

#disconnect-button{
    background:var(--danger);
}

#disconnect-button:hover{
    background:#c62828;
}

/* --- MEDIA QUERIES/RESPONSIVE ----------------- */
@media (max-width: 768px) {
    /* Layout Mobile: Griglia Video */
    #videos-grid {
        flex-direction: column;
        align-items: center;
        gap: 6px;
        justify-content: flex-start;
    }
    
    .video-feed.ratio-4-3, .video-feed.ratio-16-9 {
        width: 95%;
        height: auto;
    }
    
    .video-feed.is-focused {
        order: -1; 
        max-height: 45vh;
        /* FIX: Assicura che il video in focus usi la larghezza massima disponibile */
        width: 95% !important; 
        height: auto !important; 
    }

    /* Regole aggiuntive per assicurare la ratio corretta su mobile in focus */
    .video-feed.is-focused.ratio-4-3 video {
        aspect-ratio: 4/3;
    }

    .video-feed.is-focused.ratio-16-9 video {
        aspect-ratio: 16/9;
    }

    /* Layout Mobile: Chat */
    #chat-panel {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        background: var(--surface);
        transform: translateY(100%);
        transition: transform 0.3s ease-in-out;
        z-index: 300;
        display: flex;
        flex-direction: column;
    }
    #chat-panel.active {transform: translateY(0);}
    
    #chat-input-area {padding: 8px;}
    #chat-message-input {font-size: 0.95rem; min-height: 36px;}
    #send-chat-button {height: 36px; padding: 0 12px;}

    #main-controls-bar {
        bottom: 10px;
    }
}